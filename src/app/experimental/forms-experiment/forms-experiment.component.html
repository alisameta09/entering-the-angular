<a [routerLink]="['/profile/me']">
  <img
    src="/assets/svg/logo-small.svg"
    alt="Логотип Tik-Talk"
    class="mt40 logo-small"
  >
</a>

<form [formGroup]="form" (ngSubmit)="onSubmit($event)">
  <div class="header__wrapper mt40">
    <h4 class="h4 mb20 ">Информация о туре</h4>

    <button
      (click)="addTour()"
      class="btn mb20 add-tour-btn"
    >Добавить тур
    </button>
  </div>

  <div class="tour-info__wrapper" formArrayName="tours">

    @for (tour of form.controls.tours.controls; track tour; let i = $index) {

      <div [formGroup]="tour" class="tour-block">

        <label class="tt-control-label mb16">
          Город вылета
          <input
            class="tt-input from-city"
            type="text"
            placeholder="Введите название"
            formControlName="fromCity"
          >
        </label>

        <div class="tour-info-grid">
          <label class="tt-control-label mb16">
            Страна
            <select class="tt-input" formControlName="destination">
              <option value="" selected disabled hidden>-- Выберите страну --</option>

              @for (dest of destinations; track dest) {
                <option [value]="dest">{{ dest }}</option>
              }

            </select>
          </label>

          <label class="tt-control-label mb16">
            Дата вылета
            <input
              class="tt-input"
              type="text"
              placeholder="дд.мм.гггг"
              formControlName="date"
              [maskito]="dateMaskOptions"
            >
          </label>

          <label class="tt-control-label mb16">
            Количество ночей
            <input
              class="tt-input"
              type="text"
              placeholder="Количество ночей"
              formControlName="duration"
            >
          </label>

          <label class="tt-control-label mb16">
            Туристы
            <input
              class="tt-input"
              type="text"
              placeholder="Туристы"
              formControlName="tourists"
            >
          </label>

        </div>
        <label class="tt-control-label mb16">
          Дополнительные пожелания
          <textarea
            (input)="onTextAreaInput($event)"
            class="tt-input"
            type="text"
            placeholder="Дополнительные пожелания"
            formControlName="info"
          ></textarea>
        </label>

      </div>

      <button
        (click)="deleteTour(i)"
        class="btn mb20"
      >Удалить тур
      </button>

    }
  </div>


  <div>
    <h6 class="h6 mb20 mt20">Данные для связи</h6>

    <div class="tour-info-grid" [formGroup]="form.controls.contact">

      <label class="tt-control-label mb16">
        Тип заказчика
        <select class="tt-input" formControlName="type">
          <option [value]="ReceiverType.Person">Физическое лицо</option>
          <option [value]="ReceiverType.Legal">Юридическое лицо</option>
        </select>
      </label>

      @if (form.controls.contact.controls.type.value === ReceiverType.Legal) {
        <label class="tt-control-label mb16">
          ИНН
          <input
            class="tt-input"
            type="text"
            placeholder="Введите ИНН"
            formControlName="inn"
          >
          @if (form.controls.contact.controls.inn.touched &&
          form.controls.contact.controls.inn.hasError('required')) {
            <small>Это поле обязательно!</small>
          }
        </label>
      } @else {
        <label class="tt-control-label mb16">
          Фамилия
          <input
            class="tt-input"
            type="text"
            placeholder="Введите фамилию"
            formControlName="lastName"
          >
        </label>
      }

      <label class="tt-control-label mb16">
        Имя
        <input
          class="tt-input"
          type="text"
          placeholder="Введите имя"
          formControlName="name"
        >
        @if (form.controls.contact.controls.name.touched &&
        form.controls.contact.controls.name.hasError('required')) {
          <small>Это поле обязательно!</small>
        }
      </label>

      <label class="tt-control-label mb16">
        Номер телефона
        <input
          class="tt-input"
          type="text"
          placeholder="Номер телефона"
          formControlName="phone"
          [maskito]="phoneMaskOptions"
        >
        @if (form.controls.contact.controls.phone.touched &&
        form.controls.contact.controls.phone.hasError('required')) {
          <small>Это поле обязательно!</small>
        }
      </label>
    </div>
  </div>

  <div [formGroup]="form.controls.contact.controls.feature">
    <h6 class="h6 mb20 mt20">Выберите категорию отеля</h6>
    <div class="hotel-category__wrapper mb16">

      @for (control of form.controls.contact.controls.feature.controls | keyvalue: sort; track control; let
        i = $index) {
        <label>
          {{ features[i].label }}
          <input type="checkbox" [formControlName]="control.key">
        </label>
      }
    </div>

  </div>

  <button class="btn" type="submit">Отправить заявку</button>

</form>
